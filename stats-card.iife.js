var __defProp=Object.defineProperty,__defNormalProp=(t,e,a)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,__publicField=(t,e,a)=>__defNormalProp(t,"symbol"!=typeof e?e+"":e,a);!function(){"use strict";function t(t,e,a=!1){return!!t.hasAttribute(e)||a}function e(t,e){if(!t)return e;const a=document.createElement("div");return a.style.color=t,a.style.color?t:(console.warn(`Invalid color: "${t}", using default: ${e}`),e)}function a(t,e){if(!t)return e;const a=parseFloat(t);if(!isNaN(a)&&a.toString()===t.trim())return`${a}px`;return/^-?\d*\.?\d+(px|%|em|rem|vh|vw|vmin|vmax|ch|ex|cm|mm|in|pt|pc)$/i.test(t.trim())?t.trim():t}class n{constructor(t){__publicField(this,"host"),__publicField(this,"mediaQuery"),__publicField(this,"changeListener",null),this.host=t,this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)")}getEffectiveTheme(){const t=this.host.getAttribute("data-theme");return"light"===t?"light":"dark"===t||this.mediaQuery.matches?"dark":"light"}applyTheme(t){const e=document.createElement("style");e.textContent='\n      /* Light mode defaults (always apply first) */\n      :host {\n        --widget-bg: #ffffff;\n        --widget-text: #333333;\n        --widget-accent: #fc4c02;\n      }\n\n      /* Auto dark mode: when system prefers dark AND theme is auto or unset */\n      @media (prefers-color-scheme: dark) {\n        :host([data-theme="auto"]), :host:not([data-theme]) {\n          --widget-bg: #1a1a2e;\n          --widget-text: #e0e0e0;\n          --widget-accent: #ff6b35;\n        }\n      }\n\n      /* Manual dark mode override */\n      :host([data-theme="dark"]) {\n        --widget-bg: #1a1a2e;\n        --widget-text: #e0e0e0;\n        --widget-accent: #ff6b35;\n      }\n\n      /* Manual light mode override (explicit over auto) */\n      :host([data-theme="light"]) {\n        --widget-bg: #ffffff;\n        --widget-text: #333333;\n        --widget-accent: #fc4c02;\n      }\n    ',t.appendChild(e)}listenForChanges(t){this.changeListener=e=>{const a=this.host.getAttribute("data-theme");a&&"auto"!==a||t()},this.mediaQuery.addEventListener("change",this.changeListener)}destroy(){this.changeListener&&(this.mediaQuery.removeEventListener("change",this.changeListener),this.changeListener=null)}}class i{constructor(t,e){__publicField(this,"host"),__publicField(this,"callback"),__publicField(this,"observer",null),__publicField(this,"expectedSizes",new WeakMap),this.host=t,this.callback=e}observe(){this.observer=new ResizeObserver(t=>{requestAnimationFrame(()=>{for(const e of t){let t,a;if(e.contentBoxSize&&e.contentBoxSize.length>0){const n=e.contentBoxSize[0];t=n.inlineSize,a=n.blockSize}else t=e.contentRect.width,a=e.contentRect.height;const n=this.expectedSizes.get(e.target);n&&n.width===t&&n.height===a||(this.updateSizeAttribute(t),this.callback(t,a),this.expectedSizes.set(e.target,{width:t,height:a}))}})}),this.observer.observe(this.host)}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null)}updateSizeAttribute(t){let e;e=t<400?"compact":t<700?"medium":"large",this.host.getAttribute("data-size")!==e&&this.host.setAttribute("data-size",e)}}class o extends HTMLElement{constructor(){super(),__publicField(this,"themeManager",null),__publicField(this,"responsiveManager",null),this.attachShadow({mode:"open"})}connectedCallback(){const t=document.createElement("style");t.textContent='\n:host {\n  display: block;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n  box-sizing: border-box;\n  color: var(--widget-text, #333333);\n  background: var(--widget-bg, #ffffff);\n  width: var(--widget-width, 100%);\n  max-width: var(--widget-max-width, 800px);\n  padding: var(--widget-padding, 20px);\n  height: var(--widget-height, auto);\n\n  /* Enable container queries for CSS-only responsive design */\n  container-type: inline-size;\n  container-name: widget;\n}\n\n*, *::before, *::after {\n  box-sizing: inherit;\n}\n\n.widget-loading {\n  padding: 24px;\n  text-align: center;\n  color: #666;\n  font-size: 14px;\n}\n\n.widget-error {\n  padding: 24px;\n  text-align: center;\n  color: #999;\n  font-size: 14px;\n}\n\n/* Responsive breakpoint styles via data-size attribute */\n:host([data-size="compact"]) {\n  --widget-padding: 12px;\n  font-size: 14px;\n}\n\n:host([data-size="medium"]) {\n  --widget-padding: 16px;\n  font-size: 15px;\n}\n\n:host([data-size="large"]) {\n  --widget-padding: 20px;\n  font-size: 16px;\n}\n',this.shadowRoot.appendChild(t),this.themeManager=new n(this),this.themeManager.applyTheme(this.shadowRoot),this.themeManager.listenForChanges(()=>{this.fetchDataAndRender()}),this.responsiveManager=new i(this,(t,e)=>{this.onResize(t,e)}),this.responsiveManager.observe(),this.applyStyleAttributes(),this.showLoading(),this.fetchDataAndRender()}attributeChangedCallback(t,e,a){if(e!==a&&this.isConnected)return"data-theme"===t?(this.applyStyleAttributes(),void this.fetchDataAndRender()):void(this.isStyleAttribute(t)?this.applyStyleAttributes():this.fetchDataAndRender())}disconnectedCallback(){this.themeManager?.destroy(),this.responsiveManager?.disconnect()}isStyleAttribute(t){return["data-width","data-max-width","data-height","data-padding","data-bg","data-text-color","data-accent"].includes(t)}applyStyleAttributes(){const t=this.getAttribute("data-width");t&&this.style.setProperty("--widget-width",a(t,"100%"));const n=this.getAttribute("data-max-width");n&&this.style.setProperty("--widget-max-width",a(n,"800px"));const i=this.getAttribute("data-height");i&&(this.style.setProperty("--widget-height",a(i,"auto")),this.style.height=a(i,"auto"));const o=this.getAttribute("data-padding");o&&this.style.setProperty("--widget-padding",a(o,"20px"));const s=this.getAttribute("data-bg");s&&this.style.setProperty("--widget-bg",e(s,"#ffffff"));const r=this.getAttribute("data-text-color");r&&this.style.setProperty("--widget-text",e(r,"#333333"));const d=this.getAttribute("data-accent");d&&this.style.setProperty("--widget-accent",e(d,"#fc4c02"))}getConfig(){return{dataUrl:this.getAttribute("data-url")||this.dataUrl,colors:{background:this.getAttribute("data-bg")||void 0,text:this.getAttribute("data-text-color")||void 0,accent:this.getAttribute("data-accent")||void 0},size:{width:this.getAttribute("data-width")||void 0,maxWidth:this.getAttribute("data-max-width")||void 0,padding:this.getAttribute("data-padding")||void 0},options:{showTitle:t(this,"data-show-title",!0),customTitle:this.getAttribute("data-title")||void 0,secondaryDataUrl:this.getAttribute("data-url-secondary")||void 0}}}showLoading(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector(".widget-loading, .widget-error");t&&t.remove();const e=document.createElement("div");e.className="widget-loading",e.textContent="Loading...",this.shadowRoot.appendChild(e)}showError(t="Widget unavailable"){if(!this.shadowRoot)return;const e=Array.from(this.shadowRoot.querySelectorAll("style"));this.shadowRoot.innerHTML="",e.forEach(t=>this.shadowRoot.appendChild(t));const a=document.createElement("div");a.className="widget-error",a.textContent=t,this.shadowRoot.appendChild(a)}async fetchData(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch data: ${e.status} ${e.statusText}`);return e.json()}async fetchDataAndRender(){try{const t=this.getAttribute("data-url")||this.dataUrl;if(!t)throw new Error("No data URL provided");const e=await this.fetchData(t);if(this.shadowRoot){const t=this.shadowRoot.querySelector(".widget-loading");t&&t.remove()}this.render(e)}catch(t){console.error("Widget: Failed to load data",t),this.showError()}}onResize(t,e){}static register(t,e){customElements.get(t)?console.warn(`Custom element "${t}" already registered, skipping`):customElements.define(t,e)}}__publicField(o,"observedAttributes",["data-url","data-url-secondary","data-title","data-show-title","data-theme","data-width","data-max-width","data-height","data-padding","data-bg","data-text-color","data-accent"]);class s extends o{constructor(){super(...arguments),__publicField(this,"yearOverYearData",null)}get dataUrl(){return"/data/stats/all-time-totals.json"}connectedCallback(){if(super.connectedCallback(),this.shadowRoot){const t=document.createElement("style");t.textContent='\n.stats-card {\n  background: var(--widget-bg, #ffffff);\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  padding: 24px;\n}\n.card-title {\n  font-size: 20px;\n  font-weight: 600;\n  margin: 0 0 20px 0;\n  color: var(--widget-text, #333);\n}\n.stats-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n  gap: 16px;\n  margin-bottom: 20px;\n}\n.stat-item {\n  text-align: center;\n  padding: 12px;\n  border-radius: 8px;\n  background: rgba(252, 76, 2, 0.05);\n}\n.stat-value {\n  font-size: 28px;\n  font-weight: 700;\n  color: var(--widget-accent, #fc4c02);\n  margin: 0;\n}\n.stat-label {\n  font-size: 12px;\n  text-transform: uppercase;\n  color: #666;\n  margin: 4px 0 0 0;\n  letter-spacing: 0.5px;\n}\n.yoy-comparison {\n  border-top: 1px solid #eee;\n  padding-top: 16px;\n  margin-top: 16px;\n}\n.yoy-title {\n  font-size: 14px;\n  font-weight: 600;\n  margin: 0 0 12px 0;\n  color: #666;\n}\n.yoy-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n  gap: 12px;\n}\n.yoy-item {\n  text-align: center;\n  padding: 8px;\n  border-radius: 6px;\n  background: #f8f8f8;\n}\n.yoy-year {\n  font-size: 11px;\n  color: #888;\n  margin: 0 0 4px 0;\n}\n.yoy-value {\n  font-size: 18px;\n  font-weight: 600;\n  color: var(--widget-text, #333);\n  margin: 0;\n}\n.yoy-delta {\n  font-size: 11px;\n  margin: 4px 0 0 0;\n}\n.yoy-delta.positive {\n  color: #22c55e;\n}\n.yoy-delta.negative {\n  color: #ef4444;\n}\n\n/* Dark mode styles */\n:host([data-theme="dark"]) .stats-card {\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n}\n:host([data-theme="dark"]) .stat-item {\n  background: rgba(255, 107, 53, 0.1);\n}\n:host([data-theme="dark"]) .yoy-item {\n  background: #2a2a2a;\n}\n:host([data-theme="dark"]) .yoy-comparison {\n  border-top-color: #333;\n}\n:host([data-theme="dark"]) .stat-label,\n:host([data-theme="dark"]) .yoy-title {\n  color: #999;\n}\n:host([data-theme="dark"]) .yoy-year {\n  color: #777;\n}\n\n/* Responsive breakpoints */\n:host([data-size="compact"]) .stats-grid {\n  grid-template-columns: 1fr;\n  gap: 12px;\n}\n:host([data-size="compact"]) .stat-value {\n  font-size: 24px;\n}\n:host([data-size="compact"]) .card-title {\n  font-size: 18px;\n}\n\n:host([data-size="medium"]) .stats-grid {\n  grid-template-columns: repeat(2, 1fr);\n  gap: 14px;\n}\n',this.shadowRoot.appendChild(t)}}async fetchDataAndRender(){try{const e=this.getAttribute("data-url")||this.dataUrl;if(!e)throw new Error("No data URL provided");const a=await this.fetchData(e),n=this.getAttribute("data-url-secondary"),i="false"!==this.getAttribute("data-show-yoy");if(n&&i)try{this.yearOverYearData=await this.fetchData(n)}catch(t){console.warn("StatsCard: Could not fetch year-over-year data",t),this.yearOverYearData=null}else this.yearOverYearData=null;if(this.shadowRoot){const t=this.shadowRoot.querySelector(".widget-loading");t&&t.remove()}this.render(a)}catch(t){console.error("StatsCard: Failed to load data",t),this.showError()}}render(t){const e=t;if(!this.shadowRoot)return;const a=Array.from(this.shadowRoot.querySelectorAll("style"));this.shadowRoot.innerHTML="",a.forEach(t=>this.shadowRoot.appendChild(t));const n=document.createElement("div");n.className="stats-card";if("false"!==this.getAttribute("data-show-title")){const t=document.createElement("h2");t.className="card-title",t.textContent=this.getAttribute("data-title")||"Running Stats",n.appendChild(t)}const i=document.createElement("div");i.className="stats-grid";const o=this.createStatItem(this.formatNumber(e.totalKm,0),"Total KM");i.appendChild(o);const s=this.createStatItem(this.formatNumber(e.totalRuns,0),"Total Runs");i.appendChild(s);const r=this.createStatItem(this.formatNumber(e.totalHours,0),"Total Hours");i.appendChild(r);const d=this.createStatItem(this.formatPace(e.avgPaceMinPerKm),"Avg Pace");if(i.appendChild(d),n.appendChild(i),this.yearOverYearData){const t=this.createYearOverYearSection(this.yearOverYearData);n.appendChild(t)}this.shadowRoot.appendChild(n)}createStatItem(t,e){const a=document.createElement("div");a.className="stat-item";const n=document.createElement("p");n.className="stat-value",n.textContent=t,a.appendChild(n);const i=document.createElement("p");return i.className="stat-label",i.textContent=e,a.appendChild(i),a}createYearOverYearSection(t){const e=document.createElement("div");e.className="yoy-comparison";const a=document.createElement("h3");a.className="yoy-title",a.textContent="Year-to-Date Comparison",e.appendChild(a);const n=(new Date).getFullYear().toString(),i=((new Date).getFullYear()-1).toString();let o=0,s=0;t.forEach(t=>{t.years[n]&&(o+=t.years[n].totalKm),t.years[i]&&(s+=t.years[i].totalKm)});const r=s>0?(o-s)/s*100:0,d=document.createElement("div");d.className="yoy-grid";const c=this.createYoyItem(i,this.formatNumber(s,0)+" km",null);d.appendChild(c);const h=this.createYoyItem(n,this.formatNumber(o,0)+" km",r);return d.appendChild(h),e.appendChild(d),e}createYoyItem(t,e,a){const n=document.createElement("div");n.className="yoy-item";const i=document.createElement("p");i.className="yoy-year",i.textContent=t,n.appendChild(i);const o=document.createElement("p");if(o.className="yoy-value",o.textContent=e,n.appendChild(o),null!==a){const t=document.createElement("p");t.className="yoy-delta "+(a>=0?"positive":"negative");const e=a>=0?"+":"";t.textContent=`${e}${a.toFixed(1)}%`,n.appendChild(t)}return n}formatNumber(t,e=1){return t.toLocaleString("en-US",{minimumFractionDigits:e,maximumFractionDigits:e})}formatPace(t){const e=Math.floor(t);return`${e}:${Math.round(60*(t-e)).toString().padStart(2,"0")}`}}__publicField(s,"observedAttributes",[...o.observedAttributes,"data-show-yoy"]),o.register("strava-stats-card",s);const r={async init(t,e){const a=document.getElementById(t);if(!a)return void console.error(`StatsCard: Container element "${t}" not found`);const n=document.createElement("strava-stats-card");e.dataUrl&&n.setAttribute("data-url",e.dataUrl),e.options?.secondaryDataUrl&&n.setAttribute("data-url-secondary",e.options.secondaryDataUrl),e.options?.customTitle&&n.setAttribute("data-title",e.options.customTitle),!1===e.options?.showTitle&&n.setAttribute("data-show-title","false"),e.colors?.background&&n.setAttribute("data-bg",e.colors.background),e.colors?.text&&n.setAttribute("data-text-color",e.colors.text),e.colors?.accent&&n.setAttribute("data-accent",e.colors.accent),e.size?.width&&n.setAttribute("data-width",e.size.width),e.size?.maxWidth&&n.setAttribute("data-max-width",e.size.maxWidth),a.appendChild(n)}};window.StatsCard=r}();
