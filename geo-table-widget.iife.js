var GeoTableWidget=function(t){"use strict";var e=Object.defineProperty,n=(t,n,a)=>((t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a)(t,"symbol"!=typeof n?n+"":n,a);function a(t,e,n=!1){return!!t.hasAttribute(e)||n}function o(t,e){if(!t)return e;const n=document.createElement("div");return n.style.color=t,n.style.color?t:(console.warn(`Invalid color: "${t}", using default: ${e}`),e)}function i(t,e,n){return t?e.includes(t)?t:(console.warn(`Invalid enum value: "${t}", allowed: [${e.join(", ")}], using default: ${n}`),n):n}function s(t,e){if(!t)return e;const n=parseFloat(t);if(!isNaN(n)&&n.toString()===t.trim())return`${n}px`;return/^-?\d*\.?\d+(px|%|em|rem|vh|vw|vmin|vmax|ch|ex|cm|mm|in|pt|pc)$/i.test(t.trim())?t.trim():t}class r{constructor(t){n(this,"host"),n(this,"mediaQuery"),n(this,"changeListener",null),this.host=t,this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)")}getEffectiveTheme(){const t=this.host.getAttribute("data-theme");return"light"===t?"light":"dark"===t||this.mediaQuery.matches?"dark":"light"}applyTheme(t){const e=document.createElement("style");e.textContent='\n      /* Light mode defaults (always apply first) */\n      :host {\n        --widget-bg: #ffffff;\n        --widget-text: #333333;\n        --widget-accent: #fc4c02;\n      }\n\n      /* Auto dark mode: when system prefers dark AND theme is auto or unset */\n      @media (prefers-color-scheme: dark) {\n        :host([data-theme="auto"]), :host:not([data-theme]) {\n          --widget-bg: #1a1a2e;\n          --widget-text: #e0e0e0;\n          --widget-accent: #ff6b35;\n        }\n      }\n\n      /* Manual dark mode override */\n      :host([data-theme="dark"]) {\n        --widget-bg: #1a1a2e;\n        --widget-text: #e0e0e0;\n        --widget-accent: #ff6b35;\n      }\n\n      /* Manual light mode override (explicit over auto) */\n      :host([data-theme="light"]) {\n        --widget-bg: #ffffff;\n        --widget-text: #333333;\n        --widget-accent: #fc4c02;\n      }\n    ',t.appendChild(e)}listenForChanges(t){this.changeListener=e=>{const n=this.host.getAttribute("data-theme");n&&"auto"!==n||t()},this.mediaQuery.addEventListener("change",this.changeListener)}destroy(){this.changeListener&&(this.mediaQuery.removeEventListener("change",this.changeListener),this.changeListener=null)}}class d{constructor(t,e){n(this,"host"),n(this,"callback"),n(this,"observer",null),n(this,"expectedSizes",new WeakMap),this.host=t,this.callback=e}observe(){this.observer=new ResizeObserver(t=>{requestAnimationFrame(()=>{for(const e of t){let t,n;if(e.contentBoxSize&&e.contentBoxSize.length>0){const a=e.contentBoxSize[0];t=a.inlineSize,n=a.blockSize}else t=e.contentRect.width,n=e.contentRect.height;const a=this.expectedSizes.get(e.target);a&&a.width===t&&a.height===n||(this.updateSizeAttribute(t),this.callback(t,n),this.expectedSizes.set(e.target,{width:t,height:n}))}})}),this.observer.observe(this.host)}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null)}updateSizeAttribute(t){let e;e=t<400?"compact":t<700?"medium":"large",this.host.getAttribute("data-size")!==e&&this.host.setAttribute("data-size",e)}}class c extends HTMLElement{constructor(){super(),n(this,"themeManager",null),n(this,"responsiveManager",null),this.attachShadow({mode:"open"})}connectedCallback(){const t=document.createElement("style");t.textContent='\n:host {\n  display: block;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n  box-sizing: border-box;\n  color: var(--widget-text, #333333);\n  background: var(--widget-bg, #ffffff);\n  width: var(--widget-width, 100%);\n  max-width: var(--widget-max-width, 800px);\n  padding: var(--widget-padding, 20px);\n  height: var(--widget-height, auto);\n\n  /* Enable container queries for CSS-only responsive design */\n  container-type: inline-size;\n  container-name: widget;\n}\n\n*, *::before, *::after {\n  box-sizing: inherit;\n}\n\n.widget-loading {\n  padding: 24px;\n  text-align: center;\n  color: #666;\n  font-size: 14px;\n}\n\n.widget-error {\n  padding: 24px;\n  text-align: center;\n  color: #999;\n  font-size: 14px;\n}\n\n/* Responsive breakpoint styles via data-size attribute */\n:host([data-size="compact"]) {\n  --widget-padding: 12px;\n  font-size: 14px;\n}\n\n:host([data-size="medium"]) {\n  --widget-padding: 16px;\n  font-size: 15px;\n}\n\n:host([data-size="large"]) {\n  --widget-padding: 20px;\n  font-size: 16px;\n}\n',this.shadowRoot.appendChild(t),this.themeManager=new r(this),this.themeManager.applyTheme(this.shadowRoot),this.themeManager.listenForChanges(()=>{this.fetchDataAndRender()}),this.responsiveManager=new d(this,(t,e)=>{this.onResize(t,e)}),this.responsiveManager.observe(),this.applyStyleAttributes(),this.showLoading(),this.fetchDataAndRender()}attributeChangedCallback(t,e,n){if(e!==n&&this.isConnected)return"data-theme"===t?(this.applyStyleAttributes(),void this.fetchDataAndRender()):void(this.isStyleAttribute(t)?this.applyStyleAttributes():this.fetchDataAndRender())}disconnectedCallback(){this.themeManager?.destroy(),this.responsiveManager?.disconnect()}isStyleAttribute(t){return["data-width","data-max-width","data-height","data-padding","data-bg","data-text-color","data-accent"].includes(t)}applyStyleAttributes(){const t=this.getAttribute("data-width");t&&this.style.setProperty("--widget-width",s(t,"100%"));const e=this.getAttribute("data-max-width");e&&this.style.setProperty("--widget-max-width",s(e,"800px"));const n=this.getAttribute("data-height");n&&(this.style.setProperty("--widget-height",s(n,"auto")),this.style.height=s(n,"auto"));const a=this.getAttribute("data-padding");a&&this.style.setProperty("--widget-padding",s(a,"20px"));const i=this.getAttribute("data-bg");i&&this.style.setProperty("--widget-bg",o(i,"#ffffff"));const r=this.getAttribute("data-text-color");r&&this.style.setProperty("--widget-text",o(r,"#333333"));const d=this.getAttribute("data-accent");d&&this.style.setProperty("--widget-accent",o(d,"#fc4c02"))}getConfig(){return{dataUrl:this.getAttribute("data-url")||this.dataUrl,colors:{background:this.getAttribute("data-bg")||void 0,text:this.getAttribute("data-text-color")||void 0,accent:this.getAttribute("data-accent")||void 0},size:{width:this.getAttribute("data-width")||void 0,maxWidth:this.getAttribute("data-max-width")||void 0,padding:this.getAttribute("data-padding")||void 0},options:{showTitle:a(this,"data-show-title",!0),customTitle:this.getAttribute("data-title")||void 0,secondaryDataUrl:this.getAttribute("data-url-secondary")||void 0}}}showLoading(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector(".widget-loading, .widget-error");t&&t.remove();const e=document.createElement("div");e.className="widget-loading",e.textContent="Loading...",this.shadowRoot.appendChild(e)}showError(t="Widget unavailable"){if(!this.shadowRoot)return;const e=Array.from(this.shadowRoot.querySelectorAll("style"));this.shadowRoot.innerHTML="",e.forEach(t=>this.shadowRoot.appendChild(t));const n=document.createElement("div");n.className="widget-error",n.textContent=t,this.shadowRoot.appendChild(n)}async fetchData(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch data: ${e.status} ${e.statusText}`);return e.json()}async fetchDataAndRender(){try{const t=this.getAttribute("data-url")||this.dataUrl;if(!t)throw new Error("No data URL provided");const e=await this.fetchData(t);if(this.shadowRoot){const t=this.shadowRoot.querySelector(".widget-loading");t&&t.remove()}this.render(e)}catch(t){console.error("Widget: Failed to load data",t),this.showError()}}onResize(t,e){}static register(t,e){customElements.get(t)?console.warn(`Custom element "${t}" already registered, skipping`):customElements.define(t,e)}}n(c,"observedAttributes",["data-url","data-url-secondary","data-title","data-show-title","data-theme","data-width","data-max-width","data-height","data-padding","data-bg","data-text-color","data-accent"]);const h=class t{static sortByString(e,n,a){const o=[...e].sort((e,a)=>{const o=String(e[n]),i=String(a[n]);return t.collator.compare(o,i)});return"ascending"===a?o:o.reverse()}static sortByNumber(t,e,n){const a=[...t].sort((t,n)=>(Number(t[e])||0)-(Number(n[e])||0));return"ascending"===n?a:a.reverse()}static sort(e,n,a,o){return"number"===o?t.sortByNumber(e,n,a):t.sortByString(e,n,a)}};n(h,"collator",new Intl.Collator(void 0,{numeric:!1,sensitivity:"base"}));let l=h;class g{constructor(t,e=20){n(this,"currentPage",1),n(this,"rowsPerPage"),n(this,"totalRows"),this.totalRows=t,this.rowsPerPage=e}get totalPages(){return Math.ceil(this.totalRows/this.rowsPerPage)}get startIndex(){return(this.currentPage-1)*this.rowsPerPage}get endIndex(){return this.startIndex+this.rowsPerPage}paginate(t){return t.slice(this.startIndex,this.endIndex)}goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t)}nextPage(){this.goToPage(this.currentPage+1)}previousPage(){this.goToPage(this.currentPage-1)}updateTotal(t){this.totalRows=t,this.currentPage>this.totalPages&&(this.currentPage=1)}}const p=[{key:"countryName",label:"Country",sortable:!0,type:"string"},{key:"totalDistanceKm",label:"Distance (km)",sortable:!0,type:"number"},{key:"activityCount",label:"Runs",sortable:!0,type:"number"},{key:"citiesCount",label:"Cities",sortable:!0,type:"number"}],u=[{key:"cityName",label:"City",sortable:!0,type:"string"},{key:"countryName",label:"Country",sortable:!0,type:"string"},{key:"totalDistanceKm",label:"Distance (km)",sortable:!0,type:"number"},{key:"activityCount",label:"Runs",sortable:!0,type:"number"}],m=new CSSStyleSheet;m.replaceSync('\n.geo-table-container {\n  background: var(--widget-bg, #ffffff);\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  padding: 24px;\n}\n\n/* Dark mode box shadow */\n:host([data-theme="dark"]) .geo-table-container,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-table-container,\n  :host(:not([data-theme])) .geo-table-container {\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);\n  }\n}\n\n.table-title {\n  font-size: 20px;\n  font-weight: 600;\n  margin: 0 0 20px 0;\n  color: var(--widget-text, #333);\n}\n\n.geo-table {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 14px;\n}\n\n.geo-table caption {\n  font-size: 13px;\n  color: #888;\n  text-align: left;\n  margin-bottom: 8px;\n  padding: 4px 0;\n}\n\n/* Dark mode caption */\n:host([data-theme="dark"]) .geo-table caption,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-table caption,\n  :host(:not([data-theme])) .geo-table caption {\n    color: #aaa;\n  }\n}\n\n.geo-table th {\n  text-align: left;\n  padding: 12px 16px;\n  border-bottom: 2px solid #eee;\n  font-weight: 600;\n  color: var(--widget-text, #333);\n}\n\n/* Dark mode table header */\n:host([data-theme="dark"]) .geo-table th,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-table th,\n  :host(:not([data-theme])) .geo-table th {\n    border-bottom-color: #444;\n  }\n}\n\n.geo-table td {\n  padding: 10px 16px;\n  border-bottom: 1px solid #f0f0f0;\n  color: var(--widget-text, #333);\n}\n\n/* Dark mode table cells */\n:host([data-theme="dark"]) .geo-table td,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-table td,\n  :host(:not([data-theme])) .geo-table td {\n    border-bottom-color: #333;\n  }\n}\n\n.geo-table tbody tr:last-child td {\n  border-bottom: none;\n}\n\n.geo-table tbody tr:hover {\n  background: rgba(252, 76, 2, 0.05);\n}\n\n/* Dark mode row hover */\n:host([data-theme="dark"]) .geo-table tbody tr:hover,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-table tbody tr:hover,\n  :host(:not([data-theme])) .geo-table tbody tr:hover {\n    background: rgba(255, 107, 53, 0.1);\n  }\n}\n\n.sort-button {\n  background: none;\n  border: none;\n  cursor: pointer;\n  font: inherit;\n  width: 100%;\n  text-align: left;\n  padding: 0;\n  color: inherit;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.sort-button:hover {\n  color: var(--widget-accent, #fc4c02);\n}\n\n.sort-button:focus {\n  outline: 2px solid var(--widget-accent, #fc4c02);\n  outline-offset: 2px;\n}\n\n.sort-indicator {\n  margin-left: 8px;\n  font-size: 12px;\n  color: var(--widget-accent, #fc4c02);\n  flex-shrink: 0;\n}\n\n.number-cell {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n.pagination-controls {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  gap: 16px;\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid #eee;\n}\n\n/* Dark mode pagination border */\n:host([data-theme="dark"]) .pagination-controls,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .pagination-controls,\n  :host(:not([data-theme])) .pagination-controls {\n    border-top-color: #444;\n  }\n}\n\n.pagination-btn {\n  font-size: 12px;\n  padding: 6px 14px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  background: white;\n  color: #666;\n  cursor: pointer;\n  font-weight: 400;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n}\n\n.pagination-btn:hover:not(:disabled) {\n  background: #f5f5f5;\n  border-color: #bbb;\n}\n\n.pagination-btn:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n/* Dark mode pagination buttons */\n:host([data-theme="dark"]) .pagination-btn,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .pagination-btn,\n  :host(:not([data-theme])) .pagination-btn {\n    background: #2a2a2a;\n    border-color: #444;\n    color: #aaa;\n  }\n}\n\n:host([data-theme="dark"]) .pagination-btn:hover:not(:disabled),\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .pagination-btn:hover:not(:disabled),\n  :host(:not([data-theme])) .pagination-btn:hover:not(:disabled) {\n    background: #333;\n    border-color: #555;\n  }\n}\n\n.pagination-info {\n  font-size: 13px;\n  color: #888;\n}\n\n/* Dark mode pagination info */\n:host([data-theme="dark"]) .pagination-info,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .pagination-info,\n  :host(:not([data-theme])) .pagination-info {\n    color: #aaa;\n  }\n}\n\n/* Responsive: hide less-important columns in compact mode */\n:host([data-size="compact"]) .geo-table th.compact-hide,\n:host([data-size="compact"]) .geo-table td.compact-hide {\n  display: none;\n}\n\n:host([data-size="compact"]) .geo-table {\n  font-size: 13px;\n}\n');class b extends c{constructor(){super(),n(this,"data",[]),n(this,"sortState",{column:"totalDistanceKm",direction:"descending"}),n(this,"paginator"),n(this,"columns",p),this.paginator=new g(0,20)}get dataUrl(){return"cities"===this.getDataset()?"/data/geo/cities.json":"/data/geo/countries.json"}getDataset(){return i(this.getAttribute("data-dataset"),["countries","cities"],"countries")}connectedCallback(){const t=document.createElement("style");t.textContent='\n      :host {\n        display: block;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        box-sizing: border-box;\n        color: var(--widget-text, #333333);\n        background: var(--widget-bg, #ffffff);\n        width: var(--widget-width, 100%);\n        max-width: var(--widget-max-width, 800px);\n        padding: var(--widget-padding, 20px);\n        container-type: inline-size;\n        container-name: widget;\n      }\n      *, *::before, *::after {\n        box-sizing: inherit;\n      }\n      .widget-loading {\n        padding: 24px;\n        text-align: center;\n        color: #666;\n        font-size: 14px;\n      }\n      .widget-error {\n        padding: 24px;\n        text-align: center;\n        color: #999;\n        font-size: 14px;\n      }\n      :host([data-size="compact"]) {\n        --widget-padding: 12px;\n        font-size: 14px;\n      }\n      :host([data-size="medium"]) {\n        --widget-padding: 16px;\n        font-size: 15px;\n      }\n      :host([data-size="large"]) {\n        --widget-padding: 20px;\n        font-size: 16px;\n      }\n    ',this.shadowRoot.appendChild(t),this.shadowRoot.adoptedStyleSheets=[m],this.themeManager=new r(this),this.themeManager.applyTheme(this.shadowRoot),this.themeManager.listenForChanges(()=>{this.fetchDataAndRender()}),this.responsiveManager=new d(this,(t,e)=>{this.onResize(t,e)}),this.responsiveManager.observe();const e=this.getAttribute("data-width");e&&this.style.setProperty("--widget-width",e.includes("px")||e.includes("%")?e:`${e}px`);const n=this.getAttribute("data-max-width");n&&this.style.setProperty("--widget-max-width",n.includes("px")||n.includes("%")?n:`${n}px`);const a=this.getAttribute("data-padding");a&&this.style.setProperty("--widget-padding",a.includes("px")||a.includes("%")?a:`${a}px`);const o=this.getAttribute("data-bg");o&&this.style.setProperty("--widget-bg",o);const s=this.getAttribute("data-text-color");s&&this.style.setProperty("--widget-text",s);const c=this.getAttribute("data-accent");c&&this.style.setProperty("--widget-accent",c);const h=this.getDataset();this.columns="cities"===h?u:p;const l=function(t,e,n,a){if(!t)return e;const o=parseFloat(t);return isNaN(o)?(console.warn(`Invalid number: "${t}", using default: ${e}`),e):o<n?(console.warn(`Number ${o} below minimum ${n}, clamping to ${n}`),n):o>a?(console.warn(`Number ${o} above maximum ${a}, clamping to ${a}`),a):o}(this.getAttribute("data-rows-per-page"),20,1,50);this.paginator=new g(0,l);const b=this.getAttribute("data-default-sort")||"totalDistanceKm",f=i(this.getAttribute("data-default-sort-direction"),["ascending","descending"],"descending");this.sortState={column:b,direction:f},this.showLoading(),this.fetchDataAndRender()}render(t){this.data=t,this.paginator.updateTotal(this.data.length);const e=this.getColumnType(this.sortState.column),n=l.sort(this.data,this.sortState.column,this.sortState.direction,e),o=this.paginator.paginate(n),i=this.shadowRoot?.querySelector(".geo-table-container");i&&i.remove();const s=document.createElement("div");s.className="geo-table-container";if(a(this,"data-show-title",!0)){const t=this.getAttribute("data-title"),e="cities"===this.getDataset()?"Running by City":"Running by Country",n=document.createElement("h2");n.className="table-title",n.textContent=t||e,s.appendChild(n)}const r=document.createElement("table");r.className="geo-table",r.setAttribute("role","table");const d=document.createElement("caption");d.textContent="Sortable table - click column headers to sort",r.appendChild(d),r.appendChild(this.createTableHeader());const c=document.createElement("tbody");o.forEach(t=>{c.appendChild(this.createTableRow(t))}),r.appendChild(c),s.appendChild(r),this.paginator.totalPages>1&&s.appendChild(this.renderPaginationControls()),this.shadowRoot?.appendChild(s)}createTableHeader(){const t=document.createElement("thead"),e=document.createElement("tr");return this.columns.forEach((t,n)=>{const a=document.createElement("th"),o=this.getDataset();if(("countries"===o&&"citiesCount"===t.key||"cities"===o&&"countryName"===t.key)&&a.classList.add("compact-hide"),"number"===t.type&&a.classList.add("number-cell"),t.sortable){const e=document.createElement("button");e.className="sort-button",e.textContent=t.label,e.addEventListener("click",()=>this.handleSort(t.key));const n=document.createElement("span");n.setAttribute("aria-hidden","true"),n.className="sort-indicator",this.sortState.column===t.key?(n.textContent="ascending"===this.sortState.direction?"▲":"▼",a.setAttribute("aria-sort",this.sortState.direction)):n.textContent="♢",e.appendChild(n),a.appendChild(e)}else a.textContent=t.label;e.appendChild(a)}),t.appendChild(e),t}createTableRow(t){const e=document.createElement("tr"),n=this.getDataset();return this.columns.forEach(a=>{const o=document.createElement("td");let i;("countries"===n&&"citiesCount"===a.key||"cities"===n&&"countryName"===a.key)&&o.classList.add("compact-hide"),"number"===a.type&&o.classList.add("number-cell"),i="citiesCount"===a.key&&"cities"in t?t.cities.length:t[a.key],"number"===a.type?o.textContent=Number(i).toLocaleString():o.textContent=String(i),e.appendChild(o)}),e}handleSort(t){const e=this.shadowRoot?.querySelectorAll("th[aria-sort]");e?.forEach(t=>t.removeAttribute("aria-sort")),this.sortState.column===t?this.sortState.direction="ascending"===this.sortState.direction?"descending":"ascending":(this.sortState.column=t,this.sortState.direction="ascending"),this.paginator.goToPage(1),this.render(this.data)}renderPaginationControls(){const t=document.createElement("div");t.className="pagination-controls";const e=document.createElement("button");e.textContent="← Previous",e.className="pagination-btn",e.disabled=1===this.paginator.currentPage,e.addEventListener("click",()=>{this.paginator.previousPage(),this.render(this.data)}),t.appendChild(e);const n=document.createElement("span");n.className="pagination-info";const a=this.paginator.startIndex+1,o=Math.min(this.paginator.endIndex,this.paginator.totalRows);n.textContent=`${a}-${o} of ${this.paginator.totalRows}`,t.appendChild(n);const i=document.createElement("button");return i.textContent="Next →",i.className="pagination-btn",i.disabled=this.paginator.currentPage>=this.paginator.totalPages,i.addEventListener("click",()=>{this.paginator.nextPage(),this.render(this.data)}),t.appendChild(i),t}getColumnType(t){const e=this.columns.find(e=>e.key===t);return e?.type||"string"}}n(b,"observedAttributes",[...c.observedAttributes,"data-dataset","data-rows-per-page","data-default-sort","data-default-sort-direction"]),c.register("strava-geo-table",b);const f={version:"1.1.0",init:()=>{console.log("GeoTableWidget v1.1.0 initialized")}};return window.GeoTableWidget=f,t.GeoTableWidget=f,t.GeoTableWidgetElement=b,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t}({});
