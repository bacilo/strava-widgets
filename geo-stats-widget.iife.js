var __defProp=Object.defineProperty,__defNormalProp=(t,e,n)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,__publicField=(t,e,n)=>__defNormalProp(t,"symbol"!=typeof e?e+"":e,n);!function(){"use strict";function t(t,e,n=!1){return!!t.hasAttribute(e)||n}function e(t,e){if(!t)return e;const n=document.createElement("div");return n.style.color=t,n.style.color?t:(console.warn(`Invalid color: "${t}", using default: ${e}`),e)}function n(t,e){if(!t)return e;const n=parseFloat(t);if(!isNaN(n)&&n.toString()===t.trim())return`${n}px`;return/^-?\d*\.?\d+(px|%|em|rem|vh|vw|vmin|vmax|ch|ex|cm|mm|in|pt|pc)$/i.test(t.trim())?t.trim():t}class a{constructor(t){__publicField(this,"host"),__publicField(this,"mediaQuery"),__publicField(this,"changeListener",null),this.host=t,this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)")}getEffectiveTheme(){const t=this.host.getAttribute("data-theme");return"light"===t?"light":"dark"===t||this.mediaQuery.matches?"dark":"light"}applyTheme(t){const e=document.createElement("style");e.textContent='\n      /* Light mode defaults (always apply first) */\n      :host {\n        --widget-bg: #ffffff;\n        --widget-text: #333333;\n        --widget-accent: #fc4c02;\n      }\n\n      /* Auto dark mode: when system prefers dark AND theme is auto or unset */\n      @media (prefers-color-scheme: dark) {\n        :host([data-theme="auto"]), :host:not([data-theme]) {\n          --widget-bg: #1a1a2e;\n          --widget-text: #e0e0e0;\n          --widget-accent: #ff6b35;\n        }\n      }\n\n      /* Manual dark mode override */\n      :host([data-theme="dark"]) {\n        --widget-bg: #1a1a2e;\n        --widget-text: #e0e0e0;\n        --widget-accent: #ff6b35;\n      }\n\n      /* Manual light mode override (explicit over auto) */\n      :host([data-theme="light"]) {\n        --widget-bg: #ffffff;\n        --widget-text: #333333;\n        --widget-accent: #fc4c02;\n      }\n    ',t.appendChild(e)}listenForChanges(t){this.changeListener=e=>{const n=this.host.getAttribute("data-theme");n&&"auto"!==n||t()},this.mediaQuery.addEventListener("change",this.changeListener)}destroy(){this.changeListener&&(this.mediaQuery.removeEventListener("change",this.changeListener),this.changeListener=null)}}class o{constructor(t,e){__publicField(this,"host"),__publicField(this,"callback"),__publicField(this,"observer",null),__publicField(this,"expectedSizes",new WeakMap),this.host=t,this.callback=e}observe(){this.observer=new ResizeObserver(t=>{requestAnimationFrame(()=>{for(const e of t){let t,n;if(e.contentBoxSize&&e.contentBoxSize.length>0){const a=e.contentBoxSize[0];t=a.inlineSize,n=a.blockSize}else t=e.contentRect.width,n=e.contentRect.height;const a=this.expectedSizes.get(e.target);a&&a.width===t&&a.height===n||(this.updateSizeAttribute(t),this.callback(t,n),this.expectedSizes.set(e.target,{width:t,height:n}))}})}),this.observer.observe(this.host)}disconnect(){this.observer&&(this.observer.disconnect(),this.observer=null)}updateSizeAttribute(t){let e;e=t<400?"compact":t<700?"medium":"large",this.host.getAttribute("data-size")!==e&&this.host.setAttribute("data-size",e)}}class i extends HTMLElement{constructor(){super(),__publicField(this,"themeManager",null),__publicField(this,"responsiveManager",null),this.attachShadow({mode:"open"})}connectedCallback(){const t=document.createElement("style");t.textContent='\n:host {\n  display: block;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n  box-sizing: border-box;\n  color: var(--widget-text, #333333);\n  background: var(--widget-bg, #ffffff);\n  width: var(--widget-width, 100%);\n  max-width: var(--widget-max-width, 800px);\n  padding: var(--widget-padding, 20px);\n  height: var(--widget-height, auto);\n\n  /* Enable container queries for CSS-only responsive design */\n  container-type: inline-size;\n  container-name: widget;\n}\n\n*, *::before, *::after {\n  box-sizing: inherit;\n}\n\n.widget-loading {\n  padding: 24px;\n  text-align: center;\n  color: #666;\n  font-size: 14px;\n}\n\n.widget-error {\n  padding: 24px;\n  text-align: center;\n  color: #999;\n  font-size: 14px;\n}\n\n/* Responsive breakpoint styles via data-size attribute */\n:host([data-size="compact"]) {\n  --widget-padding: 12px;\n  font-size: 14px;\n}\n\n:host([data-size="medium"]) {\n  --widget-padding: 16px;\n  font-size: 15px;\n}\n\n:host([data-size="large"]) {\n  --widget-padding: 20px;\n  font-size: 16px;\n}\n',this.shadowRoot.appendChild(t),this.themeManager=new a(this),this.themeManager.applyTheme(this.shadowRoot),this.themeManager.listenForChanges(()=>{this.fetchDataAndRender()}),this.responsiveManager=new o(this,(t,e)=>{this.onResize(t,e)}),this.responsiveManager.observe(),this.applyStyleAttributes(),this.showLoading(),this.fetchDataAndRender()}attributeChangedCallback(t,e,n){if(e!==n&&this.isConnected)return"data-theme"===t?(this.applyStyleAttributes(),void this.fetchDataAndRender()):void(this.isStyleAttribute(t)?this.applyStyleAttributes():this.fetchDataAndRender())}disconnectedCallback(){this.themeManager?.destroy(),this.responsiveManager?.disconnect()}isStyleAttribute(t){return["data-width","data-max-width","data-height","data-padding","data-bg","data-text-color","data-accent"].includes(t)}applyStyleAttributes(){const t=this.getAttribute("data-width");t&&this.style.setProperty("--widget-width",n(t,"100%"));const a=this.getAttribute("data-max-width");a&&this.style.setProperty("--widget-max-width",n(a,"800px"));const o=this.getAttribute("data-height");o&&(this.style.setProperty("--widget-height",n(o,"auto")),this.style.height=n(o,"auto"));const i=this.getAttribute("data-padding");i&&this.style.setProperty("--widget-padding",n(i,"20px"));const s=this.getAttribute("data-bg");s&&this.style.setProperty("--widget-bg",e(s,"#ffffff"));const d=this.getAttribute("data-text-color");d&&this.style.setProperty("--widget-text",e(d,"#333333"));const r=this.getAttribute("data-accent");r&&this.style.setProperty("--widget-accent",e(r,"#fc4c02"))}getConfig(){return{dataUrl:this.getAttribute("data-url")||this.dataUrl,colors:{background:this.getAttribute("data-bg")||void 0,text:this.getAttribute("data-text-color")||void 0,accent:this.getAttribute("data-accent")||void 0},size:{width:this.getAttribute("data-width")||void 0,maxWidth:this.getAttribute("data-max-width")||void 0,padding:this.getAttribute("data-padding")||void 0},options:{showTitle:t(this,"data-show-title",!0),customTitle:this.getAttribute("data-title")||void 0,secondaryDataUrl:this.getAttribute("data-url-secondary")||void 0}}}showLoading(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector(".widget-loading, .widget-error");t&&t.remove();const e=document.createElement("div");e.className="widget-loading",e.textContent="Loading...",this.shadowRoot.appendChild(e)}showError(t="Widget unavailable"){if(!this.shadowRoot)return;const e=Array.from(this.shadowRoot.querySelectorAll("style"));this.shadowRoot.innerHTML="",e.forEach(t=>this.shadowRoot.appendChild(t));const n=document.createElement("div");n.className="widget-error",n.textContent=t,this.shadowRoot.appendChild(n)}async fetchData(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch data: ${e.status} ${e.statusText}`);return e.json()}async fetchDataAndRender(){try{const t=this.getAttribute("data-url")||this.dataUrl;if(!t)throw new Error("No data URL provided");const e=await this.fetchData(t);if(this.shadowRoot){const t=this.shadowRoot.querySelector(".widget-loading");t&&t.remove()}this.render(e)}catch(t){console.error("Widget: Failed to load data",t),this.showError()}}onResize(t,e){}static register(t,e){customElements.get(t)?console.warn(`Custom element "${t}" already registered, skipping`):customElements.define(t,e)}}__publicField(i,"observedAttributes",["data-url","data-url-secondary","data-title","data-show-title","data-theme","data-width","data-max-width","data-height","data-padding","data-bg","data-text-color","data-accent"]);class s extends i{constructor(){super(...arguments),__publicField(this,"citiesData",[]),__publicField(this,"metadataData",null)}get dataUrl(){return"/data/geo/countries.json"}async fetchAllDataAndRender(){try{const t=this.getAttribute("data-url")||this.dataUrl,e=this.getAttribute("data-url-secondary"),n=this.getAttribute("data-url-metadata"),[a,o,i]=await Promise.all([this.fetchData(t),e?this.fetchData(e):Promise.resolve([]),n?this.fetchData(n):Promise.resolve(null)]);if(this.citiesData=o,this.metadataData=i,this.shadowRoot){const t=this.shadowRoot.querySelector(".widget-loading");t&&t.remove()}this.render(a)}catch(t){console.error("GeoStatsWidget: Failed to load data",t),this.showError()}}connectedCallback(){const t=document.createElement("style");t.textContent='\n      :host {\n        display: block;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        box-sizing: border-box;\n        color: var(--widget-text, #333333);\n        background: var(--widget-bg, #ffffff);\n        width: var(--widget-width, 100%);\n        max-width: var(--widget-max-width, 800px);\n        padding: var(--widget-padding, 20px);\n        container-type: inline-size;\n        container-name: widget;\n      }\n      *, *::before, *::after {\n        box-sizing: inherit;\n      }\n      .widget-loading {\n        padding: 24px;\n        text-align: center;\n        color: #666;\n        font-size: 14px;\n      }\n      .widget-error {\n        padding: 24px;\n        text-align: center;\n        color: #999;\n        font-size: 14px;\n      }\n      :host([data-size="compact"]) {\n        --widget-padding: 12px;\n        font-size: 14px;\n      }\n      :host([data-size="medium"]) {\n        --widget-padding: 16px;\n        font-size: 15px;\n      }\n      :host([data-size="large"]) {\n        --widget-padding: 20px;\n        font-size: 16px;\n      }\n    ',this.shadowRoot.appendChild(t),this.themeManager=new a(this),this.themeManager.applyTheme(this.shadowRoot),this.themeManager.listenForChanges(()=>{this.fetchAllDataAndRender()}),this.responsiveManager=new o(this,(t,e)=>{this.onResize(t,e)}),this.responsiveManager.observe();const e=this.getAttribute("data-width");e&&this.style.setProperty("--widget-width",e.includes("px")||e.includes("%")?e:`${e}px`);const n=this.getAttribute("data-max-width");n&&this.style.setProperty("--widget-max-width",n.includes("px")||n.includes("%")?n:`${n}px`);const i=this.getAttribute("data-padding");i&&this.style.setProperty("--widget-padding",i.includes("px")?i:`${i}px`);const s=this.getAttribute("data-bg");s&&this.style.setProperty("--widget-bg",s);const d=this.getAttribute("data-text-color");d&&this.style.setProperty("--widget-text",d);const r=this.getAttribute("data-accent");r&&this.style.setProperty("--widget-accent",r),this.showLoading(),this.fetchAllDataAndRender()}render(e){if(!this.shadowRoot)return;const n=this.shadowRoot.querySelector(".geo-stats-card");if(n&&n.remove(),!this.shadowRoot.querySelector("style[data-widget-styles]")){const t=document.createElement("style");t.setAttribute("data-widget-styles","true"),t.textContent='\n.geo-stats-card {\n  background: var(--widget-bg, #ffffff);\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  padding: 24px;\n}\n\n/* Dark mode box shadow */\n:host([data-theme="dark"]) .geo-stats-card,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-stats-card,\n  :host(:not([data-theme])) .geo-stats-card {\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);\n  }\n}\n\n.card-title {\n  font-size: 20px;\n  font-weight: 600;\n  margin: 0 0 20px 0;\n  color: var(--widget-text, #333);\n}\n\n.geo-metadata {\n  font-size: 13px;\n  color: #888;\n  margin-bottom: 20px;\n  padding: 8px 12px;\n  background: rgba(252, 76, 2, 0.05);\n  border-radius: 6px;\n}\n\n/* Dark mode metadata */\n:host([data-theme="dark"]) .geo-metadata,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-metadata,\n  :host(:not([data-theme])) .geo-metadata {\n    background: rgba(255, 107, 53, 0.1);\n    color: #aaa;\n  }\n}\n\n.section-title {\n  font-size: 16px;\n  font-weight: 600;\n  margin: 24px 0 12px 0;\n  color: var(--widget-text, #333);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.section-title:first-of-type {\n  margin-top: 0;\n}\n\n.export-btn {\n  font-size: 12px;\n  padding: 4px 12px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  background: white;\n  color: #666;\n  cursor: pointer;\n  font-weight: 400;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n}\n\n.export-btn:hover {\n  background: #f5f5f5;\n  border-color: #bbb;\n}\n\n/* Dark mode export button */\n:host([data-theme="dark"]) .export-btn,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .export-btn,\n  :host(:not([data-theme])) .export-btn {\n    background: #2a2a3e;\n    border-color: #444;\n    color: #ccc;\n  }\n}\n\n:host([data-theme="dark"]) .export-btn:hover,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .export-btn:hover,\n  :host(:not([data-theme])) .export-btn:hover {\n    background: #3a3a4e;\n    border-color: #666;\n  }\n}\n\n.geo-table {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 14px;\n}\n\n/* Responsive: compact table */\n:host([data-size="compact"]) .geo-table {\n  font-size: 12px;\n}\n\n/* Hide cities column in compact mode for countries table */\n:host([data-size="compact"]) .geo-table .cities-col {\n  display: none;\n}\n\n.geo-table th {\n  text-align: left;\n  padding: 8px 12px;\n  border-bottom: 2px solid #eee;\n  color: #666;\n  font-weight: 600;\n  font-size: 12px;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n/* Dark mode table headers */\n:host([data-theme="dark"]) .geo-table th,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-table th,\n  :host(:not([data-theme])) .geo-table th {\n    border-bottom-color: #444;\n    color: #aaa;\n  }\n}\n\n.geo-table td {\n  padding: 8px 12px;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n/* Dark mode table cells */\n:host([data-theme="dark"]) .geo-table td,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .geo-table td,\n  :host(:not([data-theme])) .geo-table td {\n    border-bottom-color: #333;\n  }\n}\n\n.geo-table tr:last-child td {\n  border-bottom: none;\n}\n\n.rank-cell {\n  color: #999;\n  font-weight: 500;\n  width: 40px;\n}\n\n/* Dark mode rank cells */\n:host([data-theme="dark"]) .rank-cell,\n@media (prefers-color-scheme: dark) {\n  :host([data-theme="auto"]) .rank-cell,\n  :host(:not([data-theme])) .rank-cell {\n    color: #777;\n  }\n}\n\n.number-cell {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n.country-cell, .city-cell {\n  font-weight: 500;\n}\n',this.shadowRoot.appendChild(t)}const a=t(this,"data-show-title",!0),o=this.getAttribute("data-title"),i=t(this,"data-show-export",!0),s=function(t,e,n){if(!t)return e;const a=parseFloat(t);return isNaN(a)?(console.warn(`Invalid number: "${t}", using default: ${e}`),e):a<n?(console.warn(`Number ${a} below minimum ${n}, clamping to ${n}`),n):a}(this.getAttribute("data-max-rows"),1/0,1);let d=e,r=this.citiesData;s<1/0&&(d=e.slice(0,s),r=this.citiesData.slice(0,s));const c=document.createElement("div");if(c.className="geo-stats-card",a){const t=document.createElement("h2");t.className="card-title",t.textContent=o||"Running by Location",c.appendChild(t)}if(this.metadataData){const t=document.createElement("div");t.className="geo-metadata",t.textContent=`Based on ${this.metadataData.geocodedActivities.toLocaleString()} of ${this.metadataData.totalActivities.toLocaleString()} activities (${this.metadataData.coveragePercent}% with GPS data) - ${this.metadataData.totalDistanceKm.toLocaleString()} km total`,c.appendChild(t)}const l=this.createCountriesSection(d,i);c.appendChild(l);const h=this.createCitiesSection(r,i);c.appendChild(h),this.shadowRoot.appendChild(c)}createCountriesSection(t,e){const n=document.createElement("div"),a=document.createElement("div");a.className="section-title";const o=document.createElement("span");if(o.textContent="Countries",a.appendChild(o),e){const e=document.createElement("button");e.className="export-btn",e.textContent="Export CSV",e.addEventListener("click",()=>function(t){const e=t.map((t,e)=>[(e+1).toString(),t.countryName,t.countryIso2,t.totalDistanceKm.toString(),t.activityCount.toString(),t.cities.length.toString()]),n="\ufeff"+[["Rank","Country","ISO Code","Distance (km)","Runs","Cities"].map(t=>`"${t}"`).join(","),...e.map(t=>t.map(t=>`"${t}"`).join(","))].join("\n"),a=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),i=`running-stats-countries-${(new Date).toISOString().split("T")[0]}.csv`,s=document.createElement("a");s.href=o,s.download=i,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}(t)),a.appendChild(e)}n.appendChild(a);const i=document.createElement("table");i.className="geo-table";const s=document.createElement("thead"),d=document.createElement("tr");[{text:"Rank",className:"rank-cell"},{text:"Country",className:""},{text:"Distance (km)",className:"number-cell"},{text:"Runs",className:"number-cell"},{text:"Cities",className:"number-cell cities-col"}].forEach(({text:t,className:e})=>{const n=document.createElement("th");n.textContent=t,e&&(n.className=e),d.appendChild(n)}),s.appendChild(d),i.appendChild(s);const r=document.createElement("tbody");return t.forEach((t,e)=>{const n=document.createElement("tr"),a=document.createElement("td");a.className="rank-cell",a.textContent=(e+1).toString(),n.appendChild(a);const o=document.createElement("td");o.className="country-cell",o.textContent=t.countryName,n.appendChild(o);const i=document.createElement("td");i.className="number-cell",i.textContent=t.totalDistanceKm.toLocaleString(),n.appendChild(i);const s=document.createElement("td");s.className="number-cell",s.textContent=t.activityCount.toLocaleString(),n.appendChild(s);const d=document.createElement("td");d.className="number-cell cities-col",d.textContent=t.cities.length.toString(),n.appendChild(d),r.appendChild(n)}),i.appendChild(r),n.appendChild(i),n}createCitiesSection(t,e){const n=document.createElement("div"),a=document.createElement("div");a.className="section-title";const o=document.createElement("span");if(o.textContent="Cities",a.appendChild(o),e){const e=document.createElement("button");e.className="export-btn",e.textContent="Export CSV",e.addEventListener("click",()=>function(t){const e=t.map((t,e)=>[(e+1).toString(),t.cityName,t.countryName,t.countryIso2,t.totalDistanceKm.toString(),t.activityCount.toString()]),n="\ufeff"+[["Rank","City","Country","ISO Code","Distance (km)","Runs"].map(t=>`"${t}"`).join(","),...e.map(t=>t.map(t=>`"${t}"`).join(","))].join("\n"),a=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),i=`running-stats-cities-${(new Date).toISOString().split("T")[0]}.csv`,s=document.createElement("a");s.href=o,s.download=i,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}(t)),a.appendChild(e)}n.appendChild(a);const i=document.createElement("table");i.className="geo-table";const s=document.createElement("thead"),d=document.createElement("tr");[{text:"Rank",className:"rank-cell"},{text:"City",className:""},{text:"Country",className:""},{text:"Distance (km)",className:"number-cell"},{text:"Runs",className:"number-cell"}].forEach(({text:t,className:e})=>{const n=document.createElement("th");n.textContent=t,e&&(n.className=e),d.appendChild(n)}),s.appendChild(d),i.appendChild(s);const r=document.createElement("tbody");return t.forEach((t,e)=>{const n=document.createElement("tr"),a=document.createElement("td");a.className="rank-cell",a.textContent=(e+1).toString(),n.appendChild(a);const o=document.createElement("td");o.className="city-cell",o.textContent=t.cityName,n.appendChild(o);const i=document.createElement("td");i.textContent=t.countryName,n.appendChild(i);const s=document.createElement("td");s.className="number-cell",s.textContent=t.totalDistanceKm.toLocaleString(),n.appendChild(s);const d=document.createElement("td");d.className="number-cell",d.textContent=t.activityCount.toLocaleString(),n.appendChild(d),r.appendChild(n)}),i.appendChild(r),n.appendChild(i),n}}__publicField(s,"observedAttributes",[...i.observedAttributes,"data-url-secondary","data-url-metadata","data-show-export","data-max-rows"]),i.register("strava-geo-stats",s);const d={async init(t,e){const n=document.getElementById(t);if(!n)throw new Error(`Container element #${t} not found`);const a=document.createElement("strava-geo-stats");e.dataUrl&&a.setAttribute("data-url",e.dataUrl),e.options?.secondaryDataUrl&&a.setAttribute("data-url-secondary",e.options.secondaryDataUrl),e.options?.metadataUrl&&a.setAttribute("data-url-metadata",e.options.metadataUrl),e.options?.customTitle&&a.setAttribute("data-title",e.options.customTitle),!1===e.options?.showTitle&&a.setAttribute("data-show-title","false"),e.colors?.accent&&a.setAttribute("data-accent",e.colors.accent),e.size?.width&&a.setAttribute("data-width",e.size.width),e.size?.maxWidth&&a.setAttribute("data-max-width",e.size.maxWidth),n.appendChild(a)}};window.GeoStatsWidget=d}();
