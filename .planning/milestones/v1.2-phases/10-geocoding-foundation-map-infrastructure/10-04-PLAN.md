---
phase: 10-geocoding-foundation-map-infrastructure
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/png-modules.d.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "TypeScript compilation completes without errors on marker icon PNG imports"
    - "npm run build exits with code 0"
  artifacts:
    - path: "src/types/png-modules.d.ts"
      provides: "Type declarations for .png module imports"
      min_lines: 5
      contains: "declare module '*.png'"
  key_links:
    - from: "src/widgets/map-test-widget/index.ts"
      to: "src/types/png-modules.d.ts"
      via: "TypeScript module resolution"
      pattern: "import.*\\.png"
---

<objective>
Fix TypeScript compilation failure on Leaflet marker icon PNG imports by adding type declarations.

Purpose: Close verification gap preventing Phase 10 completion. The map widget bundles successfully via Vite (runtime unaffected), but TypeScript compilation fails due to missing type declarations for .png module imports.

Output: TypeScript build passing with type-safe PNG imports, unblocking Phase 10 verification.
</objective>

<execution_context>
@/Users/pedf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pedf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase verification gap
@.planning/phases/10-geocoding-foundation-map-infrastructure/10-VERIFICATION.md

# What was built in 10-03
@.planning/phases/10-geocoding-foundation-map-infrastructure/10-03-SUMMARY.md

# File with the TypeScript errors
@src/widgets/map-test-widget/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PNG module type declarations</name>
  <files>src/types/png-modules.d.ts</files>
  <action>
Create type declaration file for PNG module imports.

**Create src/types/png-modules.d.ts:**
```typescript
/**
 * Type declarations for PNG image imports
 * Enables TypeScript compilation of Vite-bundled image assets
 */
declare module '*.png' {
  const value: string;
  export default value;
}
```

**Why this fixes the issue:**
- TypeScript requires type declarations for non-TS/JS module imports
- Vite already handles .png imports correctly at build time (proven by successful widget bundling)
- This declaration tells TypeScript that .png imports resolve to string URLs
- Follows same pattern as existing type declarations in src/types/ (mapbox-polyline.d.ts, offline-geocoder.d.ts)

**No tsconfig.json changes needed:**
- src/types/ is already included in TypeScript compilation
- All .d.ts files in src/types/ are automatically discovered by TypeScript
- Verified by existing declarations (offline-geocoder.d.ts, mapbox-polyline.d.ts working without explicit include)
  </action>
  <verify>
Run TypeScript compilation and verify zero errors:
```bash
npm run build
echo "Exit code: $?"
```

Expected output:
- No TS2307 errors on marker-icon.png, marker-icon-2x.png, marker-shadow.png
- Exit code: 0

Verify type declaration file exists:
```bash
cat src/types/png-modules.d.ts
```
  </verify>
  <done>
- src/types/png-modules.d.ts exists with module declaration for '*.png'
- npm run build completes successfully with exit code 0
- No TypeScript errors on lines 11-13 of src/widgets/map-test-widget/index.ts
- Map widget continues to bundle successfully (dist/widgets/map-test.iife.js exists)
  </done>
</task>

</tasks>

<verification>
1. **TypeScript compilation passes:**
   ```bash
   npm run build
   ```
   Should exit 0 with no errors

2. **Widget build still works:**
   ```bash
   npm run build:widgets
   ls -lh dist/widgets/map-test.iife.js
   ```
   Should show ~30KB bundle

3. **Test suite still passes:**
   ```bash
   npm test
   ```
   Should show 18/18 tests passing

4. **Phase 10 verification gap closed:**
   Truth #5 from VERIFICATION.md ("Leaflet renders correctly in Shadow DOM with all CSS and controls working") now VERIFIED â€” TypeScript compilation no longer blocks.
</verification>

<success_criteria>
**Measurable completion:**

1. TypeScript build completes without errors (npm run build exits 0)
2. PNG module type declarations exist at src/types/png-modules.d.ts
3. Map widget bundle still generates successfully at dist/widgets/map-test.iife.js
4. Test suite continues passing (18/18)
5. Phase 10 can be marked as fully complete (all 6 success criteria verified)

**Phase 10 completion unblocked:**
This is the final gap preventing Phase 10 verification. Once resolved, all success criteria from ROADMAP.md are verified and v1.2 Phase 10 can be marked complete.
</success_criteria>

<output>
After completion, create `.planning/phases/10-geocoding-foundation-map-infrastructure/10-04-SUMMARY.md`
</output>
