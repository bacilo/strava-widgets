---
phase: 08-geographic-table-widget
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - scripts/build-widgets.mjs
  - dist/widgets/test.html
autonomous: true

must_haves:
  truths:
    - "geo-table-widget builds as an IIFE bundle alongside existing widgets"
    - "Test page demonstrates both countries and cities table widgets with working sort and pagination"
    - "Widget is embeddable on any page via a single script tag"
  artifacts:
    - path: "scripts/build-widgets.mjs"
      provides: "Build entry for geo-table-widget"
      contains: "geo-table-widget"
    - path: "dist/widgets/test.html"
      provides: "Test page with geo-table-widget instances"
      contains: "strava-geo-table"
  key_links:
    - from: "scripts/build-widgets.mjs"
      to: "src/widgets/geo-table-widget/index.ts"
      via: "widget entry point"
      pattern: "geo-table-widget/index.ts"
    - from: "dist/widgets/test.html"
      to: "dist/widgets/geo-table-widget.iife.js"
      via: "script tag"
      pattern: "geo-table-widget\\.iife\\.js"
---

<objective>
Integrate the geo-table-widget into the build system and create a comprehensive test page.

Purpose: Makes the widget buildable and deployable to GitHub Pages, and provides a visual test page to verify sorting, pagination, theming, and responsive behavior.
Output: Updated build script with geo-table-widget entry, updated test page with geo-table demos.
</objective>

<execution_context>
@/Users/pedf/.claude/get-shit-done/workflows/execute-plan.md
@/Users/pedf/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-geographic-table-widget/08-01-SUMMARY.md
@scripts/build-widgets.mjs
@dist/widgets/test.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add geo-table-widget to build system and build</name>
  <files>scripts/build-widgets.mjs</files>
  <action>
Add a new widget entry to the `widgets` array in scripts/build-widgets.mjs:

```javascript
{
  name: 'geo-table-widget',
  entry: resolve(__dirname, '../src/widgets/geo-table-widget/index.ts'),
  globalName: 'GeoTableWidget'
}
```

Add it after the existing `geo-stats-widget` entry.

Then run the full widget build to confirm it compiles:
```bash
npm run build && npm run build-widgets
```

Verify that `dist/widgets/geo-table-widget.iife.js` is produced. Check its file size is reasonable (should be small — no Chart.js dependency, pure DOM manipulation).
  </action>
  <verify>
Run `npm run build && npm run build-widgets` — must succeed with no errors. Verify `ls -la dist/widgets/geo-table-widget.iife.js` exists.
  </verify>
  <done>geo-table-widget.iife.js is built and present in dist/widgets/ alongside other widget bundles.</done>
</task>

<task type="auto">
  <name>Task 2: Update test page with geo-table-widget demos</name>
  <files>dist/widgets/test.html</files>
  <action>
Read the existing dist/widgets/test.html to understand its structure and patterns.

Add a new section for the Geographic Table Widget after existing widget sections. Include:

1. **Section header:** "Geographic Table Widget" with description

2. **Countries table (default):**
```html
<strava-geo-table
  data-url="data/geo/countries.json"
  data-dataset="countries"
  data-title="Countries I've Run In"
  data-rows-per-page="10">
</strava-geo-table>
```

3. **Cities table:**
```html
<strava-geo-table
  data-url="data/geo/cities.json"
  data-dataset="cities"
  data-title="Cities I've Run In"
  data-rows-per-page="15">
</strava-geo-table>
```

4. **Dark mode variant:**
```html
<strava-geo-table
  data-url="data/geo/countries.json"
  data-dataset="countries"
  data-theme="dark"
  data-title="Countries (Dark Mode)"
  data-rows-per-page="10"
  data-bg="#1a1a2e"
  data-text-color="#e0e0e0">
</strava-geo-table>
```

5. **Compact responsive variant:**
```html
<strava-geo-table
  data-url="data/geo/cities.json"
  data-dataset="cities"
  data-title="Cities (Compact)"
  data-max-width="400px"
  data-rows-per-page="5">
</strava-geo-table>
```

Add the script tag for the new widget:
```html
<script src="geo-table-widget.iife.js"></script>
```

Add it alongside the existing widget script tags.

Each demo should have a brief text description explaining what it demonstrates (sorting, pagination, dark mode, compact).
  </action>
  <verify>
Open dist/widgets/test.html in a browser (or check that all strava-geo-table elements are present in the HTML). Verify the script tag for geo-table-widget.iife.js is included.
  </verify>
  <done>Test page contains 4 geo-table-widget instances demonstrating countries, cities, dark mode, and compact variants with working sort and pagination.</done>
</task>

</tasks>

<verification>
1. `npm run build && npm run build-widgets` succeeds
2. `dist/widgets/geo-table-widget.iife.js` exists and is non-empty
3. `dist/widgets/test.html` includes `<script src="geo-table-widget.iife.js">` tag
4. `dist/widgets/test.html` contains at least 4 `<strava-geo-table>` elements
5. Test page loads in browser without console errors
</verification>

<success_criteria>
- Widget builds as IIFE bundle without errors
- Test page demonstrates countries table, cities table, dark mode, and compact mode
- All demos use real data URLs pointing to data/geo/*.json
- Widget is fully embeddable via single script tag + custom element
</success_criteria>

<output>
After completion, create `.planning/phases/08-geographic-table-widget/08-02-SUMMARY.md`
</output>
